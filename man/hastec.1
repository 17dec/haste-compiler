.TH HASTEC 1

.SH NAME
hastec \- compile Haskell programs into JavaScript

.SH SYNOPSIS
.B hastec
.RI [ option | filename ]...

.SH DESCRIPTION
This manual page documents briefly the
.B hastec
command.
In addition to the options listed here,
.B hastec
also accepts all the same command line options as the GHC compiler,
with the exception of
.B -prof
which is silently ignored.

.BR
By default,
.B hastec
behaves as though it was called with GHC's
.B --make
option, compiling and linking a complete JavaScript program which,
when included into a web page, sets the program's
.B main
function to execute when the page has finished loading.



.SH OPTIONS
Options are processed from left to right. If two conflicting options are given,
the latter will take precedence. This means that you can use options such as
.B --opt-all
which imply multiple other options, and selectively disable any
implied options that you don't want. For instance, the command line
.B hastec --opt-all --opt-tail-loop-transform=off
will enable all safe optimizations except for the tail loop transformation.


.SS Linking

.TP
.BR \-\-dont\-link
Don't link generated .jsmod files into a .js blob.

.TP
.BR \-\-link\-jslib [=\fIFILE\fR]
Create a jslib file instead of an executable. If no FILE is given, the package
key of the library currently being compiled is used as the library file name.

.TP
.BR \-\-with\-js =\fIFILES\fR
Link the given comma-separated list of JavaScript files into the final .js file.


.SS Program startup

.TP
.BR \-\-onexec
Launch application immediately when the JavaScript file is loaded.
Shorthand for
.B --start=onexec.

.TP
.BR \-\-onload
Launch application on window.onload. Shorthand for
.B --start=onload.
This is the default behavior.

.TP
.BR \-\-start =\fICODE\fR
Specify custom start code. '$HASTE_MAIN' will be replaced with the
application's main function. For instance,
.B --start='$("foo").onclick($HASTE_MAIN);'
will use jQuery to launch the
application whenever the element with the id "foo" is clicked.


.SS Output control

.TP
.BR \-o\fIFILE\fR ", " \-\-out =\fIFILE\fR
Write JavaScript output to FILE.

.TP
.BR \-\-outdir =\fIDIR\fR
Write intermediate files to DIR.

.TP
.BR \-\-output\-html
Write the JavaScript output to an HTML file with a simple HTML skeleton.

.TP
.BR \-\-own\-namespace
Wrap the whole program in a closure to avoid polluting the global namespace.
Incurs a performance hit, and makes minification slightly less effective.


.SS Code generation

.TP
.BR \-\-full\-unicode
Enable full generalCategory Unicode support. May bloat output by upwards of
150 KB.

.TP
.BR \-\-no\-use\-strict
Do not emit '"use strict";' declaration. Does not affect minifier behavior,
but
.B does
affect any external JavaScript included using
.B --with-js
\.

.TP
.BR \-\-overwrite\-scrutinees
Overwrite scrutinees when evaluated rather than allocating a new local for
the evaluated value. This is largely experimental.

.TP
.BR \-\-output\-jsflow
Output code for use with the JSFlow interpreter. Note that this may leave
your code crippled, since JSFlow doesn't support all of Haste's needs.


.SS Debugging

.TP
.BR \-\-annotate\-externals
Annotate all JavaScript-native symbols and inline JavaScript in
generated code with /* EXTERNAL */.

.TP
.BR \-\-annotate\-symbols
Annotate all non-external, non-local symbols with their qualified Haskell names.

.TP
.BR \-\-debug
Output annotated, pretty-printed JavaScript code.
Equivalent to
.B --annotate-externals --annotate-symbols --pretty-print
\.

.TP
.BR \-\-ddisable\-js\-opts
Disable any and all optimizations over the resulting JavaScript code.
This notably includes tail call optimization.

.TP
.BR \-\-dtrace\-primops
Trace primops.
Not really useful unless Haste was booted with primop tracing enabled.

.TP
.BR \-\-preserve\-names
Preserve Haskell names in JavaScript code as far as possible.
Highly experimental and may break your code.

.TP
.BR \-\-pretty\-print
Print JavaScript output using whitespace and indentation.


.SS Optimization

.TP
.BR \-\-opt\-all
Enable all safe optimizations except minification. Individual optimizations
may be turned off using their individual flags.

.TP
.BR \-\-opt\-detrampoline\-threshold =\fIN\fR
Remove trampolining and tail calls for provably finite tail call chains shorter
than \fIN\fR calls. Set to \fI0\fR to disable. A value of \fIN=3\fR is
implied by
.B --opt-all.

.TP
.BR \-\-opt\-flow-analysis [=\fIon\fR/\fIoff\fR]
Enable whole program flow analysis. Highly experimental and possibly slow
and/or incorrect. Don't use for now.

.TP
.BR \-\-opt\-inline-ffi\-primitives [=\fIon\fR/\fIoff\fR]
Inline FFI call primitives where possible.

.TP
.BR \-\-opt\-minify [=\fIon\fR/\fIoff\fR]
Minify JavaScript output using Google Closure compiler.

.TP
.BR \-\-opt\-minify\-flag =\fIFLAG\fR
Pass a flag to Closure. To minify programs in strict mode, use
.B --opt-minify-flag='--language_in=ECMASCRIPT5_STRICT'.

.TP
.BR \-\-opt\-tail-chain-bound =\fIN\fR
Bound tailcall chains at \fIN\fR stack frames.
By default, tail call chains are not allowed to grow the call stack at all.
This is very inefficient, however, so ideally one wants to strike a balance
between amortizing the cost of the trampolining machinery and the size of the
call stack. A value between 10 and 100 is usually a good choice.

.TP
.BR \-\-opt\-tail\-loop\-transform [=\fIon\fR/\fIoff\fR]
Optimize tail recursive functions into loops when possible.
Enabled by default.

.TP
.BR \-\-opt\-unsafe
Enable all optimizations, safe and unsafe. Equivalent to
.B --opt-all --opt-unsafe-ints.

.TP
.BR \-\-opt\-unsafe\-ints
Enable unsafe Int arithmetic. Implies
.B --opt-unsafe-mult --opt-vague-ints.

.TP
.BR \-\-opt\-unsafe\-mult [=\fIon\fR/\fIoff\fR]
Use JavaScript's built-in multiplication operator for fixed precision integer
multiplication. This may speed up Int multiplication by a factor of at least
four, but may give incorrect results when the product falls outside the
interval [-2^52, 2^52]. In browsers which support Math.imul, this
optimization will likely be slower than the default.

.TP
.BR \-\-opt\-vague\-ints [=\fIon\fR/\fIoff\fR]
Int math has 53 bits of precision, but gives incorrect results rather than
properly wrapping around when those 53 bits are exceeded. Bitwise operations
still only work on the lowest 32 bits.

.TP
.BR \-\-opt\-whole\-program [=\fIon\fR/\fIoff\fR]
Perform optimizations over the whole program during linking. May
significantly increase link time.


.SS Misc. options

.TP
.BR \-? ", " \-\-help
Display help message.

.TP
.BR \-v ", " \-\-verbose
Display even the most obnoxious warnings and messages.
